<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="~/assets/css/styles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r126/three.min.js"></script>
  <script src="https://unpkg.com/three@0.126.0/examples/js/loaders/GLTFLoader.js"></script>
</head>
<body>

  <!-- Header -->
  <header>
    <div class="logo">Logo</div> <!-- Zde vložte své logo -->
    <button class="contact-btn" id="contact-us-btn">Contact us</button>
  </header>

  <div id="scene-container" class="light-mode">
    <h1 class="homepage-title" id="background-text">KUMO</h1>
    <div id="car-container"></div>
    <button id="back-button" class="hidden">Back to depo</button>

    <!-- Klikací body -->
    <div class="clickable-point" id="door-point" data-title-text="Services1" data-text="Nejen našemu hlavnímu partnerovi, ale i dalším klientům zajišťujeme vnitrostátní přepravu zásilek. Kvalita distribuce zásilek začíná již v depu našeho partnera UPS. O samotnou distribuci zásilek se stará flotila více než 50 vozů." style="top: 45%; left: 50%;"></div>
    <div class="clickable-point" id="trunk-point" data-title-text="Services2" data-text="Jsme oficiálním partnerem přepravní společnosti UPS. Zajišťujeme vnitrostátní a mezinárodní dopravu do 3,5 tuny včetně." style="top: 65%; left: 30%;"></div>
    <div class="clickable-point" id="hood-point" data-title-text="Services3" data-text="Po více než 10 letech partnerství se společností UPS jsme založili firmu KUMO Transport s.r.o. Jsme jedním z hlavních partnerů společnosti UPS. V rámci naší spolupráce zajišťujeme přepravu kusových zásilek nejen v České republice. Ročně přepravíme přes 700 tisíc zásilek, což zajišťuje stabilní růst společnosti.

V budoucích letech plánujeme dále expandovat v rámci Evropské unie." style="top: 50%; left: 60%;"></div>


    <!-- Informační pole -->
    <div id="info-box" class="hidden">
      <p id="info-text"></p>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <div class="footer-logo">Footer Logo</div>
  </footer>

  <script>
    let scene, camera, renderer, model;
    let defaultBackgroundColor = "#e7e8ea";
    let focusBackgroundColor = "#0f1819";
    let isFocused = false;

    function init() {
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 0.8, 5);

        renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.getElementById("car-container").appendChild(renderer.domElement);

        const loader = new THREE.GLTFLoader();
        loader.load("/assets/glb/van.glb", function (gltf) {
            model = gltf.scene;
            model.position.y = 0;
            model.rotation.y = Math.PI / 1.15;
            model.scale.set(2, 2, 2);
            model.traverse(node => {
            if (node.isMesh) {
                node.castShadow = true;
            }
        });
            scene.add(model);
            animate();
        });

    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(3, 3, 5);
    light.castShadow = true;
    scene.add(light);

        // Plán pod auto pro stín
    const planeGeometry = new THREE.PlaneGeometry(10, 10);
    const planeMaterial = new THREE.ShadowMaterial({ opacity: 0.5 });
    const plane = new THREE.Mesh(planeGeometry, planeMaterial);
    plane.rotation.x = -Math.PI / 2;
    plane.position.y = -0.1;
    plane.receiveShadow = true;
    scene.add(plane);

    }

    function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
    }

    function moveToPart(targetRotation, text, titleText) {
        if (!model) return;

        let startRotation = model.rotation.y;
        let target = targetRotation;
        let duration = 500; // Trvání animace v ms
        let startTime = performance.now();

        function animateRotation(currentTime) {
            let elapsed = currentTime - startTime;
            let progress = Math.min(elapsed / duration, 1); // Zajistí, že hodnota nepřekročí 1

            model.rotation.y = startRotation + (target - startRotation) * progress;

            if (progress < 1) {
                requestAnimationFrame(animateRotation);
            } else {
                isFocused = true;
                updateUI(text);

                // Až po dokončení rotace, změň titulek
                const backgroundText = document.getElementById("background-text");
                backgroundText.textContent = titleText;  // Používáme data-title-text pro titulek
            }
        }

        requestAnimationFrame(animateRotation);
    }



    function resetView() {
        if (!model) return;

        let startRotation = model.rotation.y;
        let target = Math.PI / 1.15; // Výchozí rotace
        let duration = 500; // Trvání animace v ms
        let startTime = performance.now();

        function animateRotation(currentTime) {
            let elapsed = currentTime - startTime;
            let progress = Math.min(elapsed / duration, 1);

            model.rotation.y = startRotation + (target - startRotation) * progress;

            if (progress < 1) {
                requestAnimationFrame(animateRotation);
            } else {
                isFocused = false;
                updateUI(); // Aktualizuje UI po dokončení animace
                // Pokud nejsme ve focused módu, nastavíme zpět titulek na "KUMO"
                const backgroundText = document.getElementById("background-text");
                if (!isFocused) {
                    backgroundText.textContent = "KUMO"; // Výchozí text
                }
            }
        }

        requestAnimationFrame(animateRotation);
    }


    function updateUI(text = "") {
        const sceneContainer = document.getElementById("scene-container");
        const backgroundText = document.getElementById("background-text");
        const infoBox = document.getElementById("info-box");
        const infoText = document.getElementById("info-text");
        const backButton = document.getElementById("back-button");
        const clickablePoints = document.querySelectorAll(".clickable-point");

        if (isFocused) {
            sceneContainer.style.backgroundColor = focusBackgroundColor;
            backgroundText.style.color = "#ffffff";
            clickablePoints.forEach(point => point.style.display = "none");
            infoText.textContent = text;
            infoBox.classList.remove("hidden");
            backButton.classList.remove("hidden");
            backgroundText.classList.add("focused");
        } else {
            sceneContainer.style.backgroundColor = defaultBackgroundColor;
            backgroundText.style.color = "#212529";
            clickablePoints.forEach(point => point.style.display = "block");
            infoBox.classList.add("hidden");
            backButton.classList.add("hidden");
            backgroundText.classList.remove("focused");

        }
    }

     document.getElementById("door-point").addEventListener("click", function(event) {
        moveToPart(Math.PI / 2, event.target.dataset.text, event.target.dataset.titleText); // Předání obou dat
    });
    document.getElementById("trunk-point").addEventListener("click", function(event) {
        moveToPart(Math.PI, event.target.dataset.text, event.target.dataset.titleText); // Předání obou dat
    });
    document.getElementById("hood-point").addEventListener("click", function(event) {
        moveToPart(0, event.target.dataset.text, event.target.dataset.titleText); // Předání obou dat
    });


    document.getElementById("back-button").addEventListener("click", resetView);

    window.onload = init;
  </script>
</body>
</html>
