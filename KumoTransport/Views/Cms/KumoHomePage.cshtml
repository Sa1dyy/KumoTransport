@model KumoHomePage
@{
  Layout = null;
}
<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="~/assets/css/styles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r126/three.min.js"></script>
  <script src="https://unpkg.com/three@0.126.0/examples/js/loaders/GLTFLoader.js"></script>
</head>
<body class="scene-default">

  <!-- Header -->
  <header class="scene-default">
    <div class="header-left">
      <button id="back-button" class="back-button hidden">
        <span class="circle">
          <span class="arrow-left"></span>
        </span>
        <span class="text">Back to depo</span>
      </button>
    </div>
    <div class="logo">
      <img id="site-logo" src="/uploads/img/GroupLogoBlack.png" alt="KUMO Logo">
    </div>
    <div class="header-right">
      <button id="menu-button" class="menu-button default">
        MENU
        <span class="icon">
          <div></div>
        </span>
      </button>
      <button id="close-menu" class="close-button hidden">
        <span class="text">CLOSE</span>
        <span class="icon-x">✕</span>
      </button>
    </div>
  </header>

  <!-- Hlavní scéna -->
  <div id="scene-container" class="light-mode">

    <!-- Menu overlay -->
    <div id="menu-overlay" class="menu-overlay hidden">
      <div class="menu-links">
        <div class="menu-link" data-part="about" data-title="ABOUT US">ABOUT US</div>
        <div class="menu-link" data-part="services" data-title="SERVICES">SERVICES</div>
        <div class="menu-link" data-part="contact" data-title="CONTACT">CONTACT</div>
        <div class="menu-link" data-part="investors" data-title="PRO INVESTORY">PRO INVESTORY</div>
      </div>
      <footer class="menu-footer">
        <div>KUMO TRANSPORT<br>Kaprova 42/14<br>110 00 Praha</div>
        <div>IČO: 19944705<br>DIČ: CZ19944705</div>
        <div>info@kumotransport.cz<br>+420 723 220 484</div>
      </footer>
    </div>

    <h1 class="homepage-title" id="background-text">KUMO</h1>
    <div id="car-container"></div>

    <!-- Klikací body -->
    <div class="clickable-point" id="door-point" data-title-text="Services1" data-position="right" data-text="@Model.DoorText?.Value" style="top: 45%; left: 50%;"></div>
    <div class="clickable-point" id="trunk-point" data-title-text="Services2" data-position="left" data-text="@Model.TrunkText?.Value" style="top: 50%; left: 60%;"></div>
    <div class="clickable-point" id="hood-point" data-title-text="Services3" data-position="bottom" data-text="@Model.HoodText?.Value" style="top: 65%; left: 30%;"></div>

    <!-- Info box -->
    <div id="info-box" class="hidden">
      <!-- Titulek -->
      <h2 id="info-title"></h2>

      <!-- Layout pro dveře (4 sloupce) -->
      <div id="info-layout-door" class="info-layout hidden">
        <div class="info-col info-main-text"></div>
        <div class="info-col info-secondary-text">10+ let zkušeností</div>
        <div class="info-col info-secondary-text">700 000+ zásilek ročně</div>
      </div>

      <!-- Layout pro kufr -->
      <div id="info-layout-trunk" class="info-layout hidden">
        <p id="info-text-trunk"></p>
      </div>

      <!-- Layout pro kapotu -->
      <div id="info-layout-hood" class="info-layout hidden">
        <div class="info-contacts">
          <div class="contact">
            <img src="/uploads/img/kubin.jpg" alt="Kontakt 1">
            <div class="contact-name">Jakub Kubín</div>
          </div>
          <div class="contact">
            <img src="/uploads/img/motl.jpg" alt="Kontakt 2">
            <div class="contact-name">Michal Motl</div>
          </div>
        </div>
        <div class="info-contact-details">
          <div class="contact-box">info@kumotransport.cz</div>
          <div class="contact-box">+420 723 220 484</div>
        </div>
      </div>
    </div>

  </div>

  <!-- Footer -->
  <footer class="scene-default">
    <div class="footer-logo">Footer Logo</div>
  </footer>

  <!-- Serverové texty do JS -->
  <script>
    const kumoTexts = {
      door: @Html.Raw(Json.Serialize(Model.DoorText?.Value ?? "")),
      trunk: @Html.Raw(Json.Serialize(Model.TrunkText?.Value ?? "")),
      hood: @Html.Raw(Json.Serialize(Model.HoodText?.Value ?? "")),
      investors: "Zde bude investorský text"
    };
  </script>

  <!-- Funkce & Three.js -->
  <script>
    let scene, camera, renderer, model;
    let defaultBackgroundColor = "#e7e8ea";
    let focusBackgroundColor = "#0f1819";
    let isFocused = false;

    const defaultRotation = Math.PI / 0.55; // výchozí pozice modelu
    const ROTATIONS = {
      default: defaultRotation,
      door: (3 * Math.PI) / 2,   // otočení doprava
      trunk: Math.PI,      // otočení dozadu
      hood: 0                // čumák vpřed
    };

    function init() {
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(0, 0.8, 5);

      renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.shadowMap.enabled = true;
      document.getElementById("car-container").appendChild(renderer.domElement);

      const loader = new THREE.GLTFLoader();
      loader.load("/assets/glb/dodavka.glb", function (gltf) {
        model = gltf.scene;
        model.position.y = 0;
        model.rotation.y = defaultRotation;
        model.scale.set(0.7, 0.7, 0.7);
        model.traverse(node => { if (node.isMesh) node.castShadow = true; });
        scene.add(model);
        animate();
      });

      const light = new THREE.DirectionalLight(0xffffff, 1);
      light.position.set(3, 3, 5);
      light.castShadow = true;
      scene.add(light);

      const plane = new THREE.Mesh(new THREE.PlaneGeometry(10, 10), new THREE.ShadowMaterial({ opacity: 0.5 }));
      plane.rotation.x = -Math.PI / 2;
      plane.position.y = -0.1;
      plane.receiveShadow = true;
      scene.add(plane);
    }

    function animate() {
      requestAnimationFrame(animate);
      renderer.render(scene, camera);
    }

    function moveToPart(targetRotation, titleText, position, clickedPart) {
      if (!model) return;

      toggleMenuButtons(false);

      const startRotation = model.rotation.y;
      const duration = 500;
      const startTime = performance.now();

      function animateRotation(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);


        let delta = targetRotation - startRotation;
        delta = ((delta + Math.PI) % (2 * Math.PI)) - Math.PI;

        model.rotation.y = startRotation + delta * progress;

        if (progress < 1) {
          requestAnimationFrame(animateRotation);
        } else {
          isFocused = true;
          updateUI(titleText, position, clickedPart);
          document.getElementById("background-text").textContent = titleText;
          document.getElementById("back-button").classList.remove("hidden");
        }
      }

      requestAnimationFrame(animateRotation);
    }


    function resetView() {
      if (!model) return;

      const startRotation = model.rotation.y;
      const target = Math.PI / 0.55;
      const duration = 500;
      const startTime = performance.now();

      function animateRotation(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        model.rotation.y = startRotation + (target - startRotation) * progress;

        if (progress < 1) {
          requestAnimationFrame(animateRotation);
        } else {
          isFocused = false;
          updateUI();
          document.getElementById("background-text").textContent = "KUMO";
          document.getElementById("back-button").classList.add("hidden");
        }
      }

      requestAnimationFrame(animateRotation);
    }
    function updateUI(text = "", position = "", clickedPart = "") {
      const body = document.body;
      const header = document.querySelector("header");
      const footer = document.querySelector("footer");
      const backgroundText = document.getElementById("background-text");
      const infoBox = document.getElementById("info-box");
      const infoTitle = document.getElementById("info-title");
      const clickablePoints = document.querySelectorAll(".clickable-point");
      const menuButton = document.getElementById("menu-button");

      // Skryj všechny layouty
      document.querySelectorAll(".info-layout").forEach(layout => layout.classList.add("hidden"));

      infoBox.classList.remove("info-left", "info-right", "info-bottom", "info-top");

      if (position) {
        infoBox.classList.add(`info-${position}`);
      }

      if (isFocused) {
        // Barvy
        body.classList.replace("scene-default", "scene-focused");
        header.classList.replace("scene-default", "scene-focused");
        footer.classList.replace("scene-default", "scene-focused");

        backgroundText.style.color = "#ffffff";
        clickablePoints.forEach(p => p.style.display = "none");
        infoBox.classList.remove("hidden");
        backgroundText.classList.add("focused");

        document.getElementById("site-logo").src = "/uploads/img/GroupLogoWhite.png";

        menuButton.classList.replace("default", "focused");

        // ✨ Dynamické rozvržení
        infoTitle.textContent = text;

        if (clickedPart === "door") {
          document.getElementById("info-layout-door").classList.remove("hidden");
          document.querySelector("#info-layout-door .info-main-text").textContent = kumoTexts.door;
        } else if (clickedPart === "trunk") {
          document.getElementById("info-layout-trunk").classList.remove("hidden");
          document.getElementById("info-text-trunk").textContent = kumoTexts.trunk;
        } else if (clickedPart === "hood") {
          document.getElementById("info-layout-hood").classList.remove("hidden");
          infoTitle.style.display = "none";

          // Text už je statický (fotky + jména + boxy), lze upravit, pokud budeš chtít dynamicky
        }

      } else {
        body.classList.replace("scene-focused", "scene-default");
        header.classList.replace("scene-focused", "scene-default");
        footer.classList.replace("scene-focused", "scene-default");

        infoTitle.style.display = "block";
        infoTitle.textContent = text;

        backgroundText.style.color = "#212529";
        clickablePoints.forEach(p => p.style.display = "block");
        infoBox.classList.add("hidden");
        backgroundText.classList.remove("focused");

        document.getElementById("site-logo").src = "/uploads/img/GroupLogoBlack.png";

        menuButton.classList.replace("focused", "default");
      }
    }

    // ⏳ INIT
    window.onload = init;

    // 📌 Interakce klikacích bodů
    document.getElementById("door-point").addEventListener("click", e => {
      moveToPart(ROTATIONS.door, e.target.dataset.titleText, "bottom", "door");
    });

    document.getElementById("trunk-point").addEventListener("click", e => {
      moveToPart(ROTATIONS.trunk, e.target.dataset.titleText, "left", "trunk");
    });

    document.getElementById("hood-point").addEventListener("click", e => {
      moveToPart(ROTATIONS.hood, e.target.dataset.titleText, "left", "hood");
    });


    document.getElementById("back-button").addEventListener("click", resetView);

    // 📂 MENU logika
    const menuBtn = document.getElementById("menu-button");
    const closeBtn = document.getElementById("close-menu");
    const overlay = document.getElementById("menu-overlay");

    function toggleMenuButtons(show) {
      overlay.classList.toggle("hidden", !show);
      menuBtn.classList.toggle("hidden", show);
      closeBtn.classList.toggle("hidden", !show);
    }

    menuBtn.onclick = () => toggleMenuButtons(true);
    closeBtn.onclick = () => toggleMenuButtons(false);

    // 🧭 Navigace z menu
    document.querySelectorAll(".menu-link").forEach(link => {
      link.addEventListener("click", () => {
        let rot = 0, text = "", title = link.dataset.title, position = "", part = "";

        switch (link.dataset.part) {
          case "about":
            rot = ROTATIONS.hood;
            text = kumoTexts.hood;
            title = "ABOUT US";
            position = "left";
            part = "hood";
            break;
          case "services":
            rot = ROTATIONS.door;
            text = kumoTexts.door;
            title = "SERVICES";
            position = "bottom";
            part = "door";
            break;
          case "contact":
            rot = ROTATIONS.trunk;
            text = kumoTexts.trunk;
            title = "CONTACT";
            position = "left";
            part = "trunk";
            break;
          case "investors":
            rot = defaultRotation;
            text = kumoTexts.investors;
            title = "PRO INVESTORY";
            position = "right"; // nastav podle potřeby
            part = "investors"; // případně přidej nový layout
            break;
        }

        toggleMenuButtons(false);
        moveToPart(rot, title, position, part);
      });
    });

  </script>
</body>
</html>